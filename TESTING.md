# テストドキュメント

このプロジェクトには、ユニットテストとE2Eテストが実装されています。

## テストの種類

### ユニットテスト（小サイズテスト）

`src/lib/__tests__/fovfix.test.ts` にFOV修正アルゴリズムのユニットテストが含まれています。

**テスト対象:**
- `FovSchema`: FOV値のバリデーション（1-179の範囲、整数のみ）
- `imageToCanvas`: 画像をCanvasに変換する関数
- `canvasToBlob`: CanvasをBlobに変換する関数
- `applyFovFix`: FOV修正アルゴリズムの中核となる関数

**実行方法:**
```bash
# 一度だけ実行
npm run test

# ウォッチモード（ファイル変更を監視）
npm run test:watch

# UIモード
npm run test:ui
```

### E2Eテスト（大サイズテスト）

`e2e/app.spec.ts` に正常系のユーザーシナリオをカバーするE2Eテストが含まれています。

**テストシナリオ:**

1. **メインワークフロー**: 写真アップロード → FOV調整 → 修正 → ダウンロード
   - ページアクセス
   - 写真のアップロード
   - FOV値の確認と変更
   - 修正ボタンのクリック
   - 処理完了の確認
   - ダウンロードボタンの表示確認

2. **複数画像の一括処理**: 複数の写真を一度に処理

3. **クリア機能**: アップロードした画像をクリアする機能

4. **バリデーション**: 無効なFOV値に対する動作確認

**実行方法:**
```bash
# E2Eテストを実行
npm run test:e2e

# UIモード（デバッグに便利）
npm run test:e2e:ui
```

## すべてのテストを実行

```bash
npm run test:all
```

これにより、ユニットテストとE2Eテストの両方が実行されます。

## テストの設計思想

### テストサイズの意識

- **小サイズテスト（ユニットテスト）**: 個別の関数やモジュールを高速にテスト
- **大サイズテスト（E2Eテスト）**: ユーザーの視点から、アプリケーション全体の動作をテスト

### 正常系の保証

E2Eテストでは、ユーザーが実際に操作する正常系のシナリオを最初から最後までカバーしています。
このアプリケーションは比較的小規模なため、1つのメインE2Eテストシナリオで正常系の大部分を保証できます。

## CI/CDでの実行

これらのテストは、GitHub ActionsなどのCI/CD環境でも実行できます。
Playwrightは必要なブラウザを自動的にインストールします。

## トラブルシューティング

### ビルドエラー

テスト関連のファイルは `tsconfig.json` の `exclude` に含まれています。
もしビルドエラーが発生した場合は、設定を確認してください。

### E2Eテストが失敗する

- ポート3000が既に使用されていないか確認してください
- `npm run build` が正常に完了することを確認してください
- `out/` ディレクトリが存在し、静的ファイルが生成されていることを確認してください
